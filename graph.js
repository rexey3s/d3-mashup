
var dataset = {
  nodes:[
    {
        "id": 0,
        "label": "Weapon"
    },
    {
        "id": 1,
        "label": "Car"
    },
    {
        "id": 2,
        "label": "PassengerAircraft"
    },
    {
        "id": 3,
        "label": "RailWayTransport"
    },
    {
        "id": 4,
        "label": "PassengerTrain"
    },
    {
        "id": 5,
        "label": "OnRoadAndOffRoadVehicle"
    },
    {
        "id": 6,
        "label": "Vessel"
    },
    {
        "id": 7,
        "label": "FreightTrain"
    },
    {
        "id": 8,
        "label": "HoverCraft"
    },
    {
        "id": 9,
        "label": "FighterAircraft"
    },
    {
        "id": 10,
        "label": "Wagon"
    },
    {
        "id": 11,
        "label": "Axile"
    },
    {
        "id": 12,
        "label": "Diesel"
    },
    {
        "id": 13,
        "label": "Bike"
    },
    {
        "id": 14,
        "label": "RotorSystem"
    },
    {
        "id": 15,
        "label": "Sprocket"
    },
    {
        "id": 16,
        "label": "Thing"
    },
    {
        "id": 17,
        "label": "FreightWagon"
    },
    {
        "id": 18,
        "label": "Engine"
    },
    {
        "id": 19,
        "label": "Wheel"
    },
    {
        "id": 20,
        "label": "Passenger"
    },
    {
        "id": 21,
        "label": "LocomotiveUnit"
    },
    {
        "id": 22,
        "label": "CargoAircraft"
    },
    {
        "id": 23,
        "label": "Bus"
    },
    {
        "id": 24,
        "label": "Pilot"
    },
    {
        "id": 25,
        "label": "Cargo"
    },
    {
        "id": 26,
        "label": "Steam"
    },
    {
        "id": 27,
        "label": "More_Cargo"
    },
    {
        "id": 28,
        "label": "ElectricEngine"
    },
    {
        "id": 29,
        "label": "Motorcycle"
    },
    {
        "id": 30,
        "label": "Aircraft"
    },
    {
        "id": 31,
        "label": "ICE"
    },
    {
        "id": 32,
        "label": "FixedWing"
    },
    {
        "id": 33,
        "label": "ShipAndVessel"
    },
    {
        "id": 34,
        "label": "Helicopter"
    },
    {
        "id": 35,
        "label": "Driver"
    },
    {
        "id": 36,
        "label": "NarrowBody"
    },
    {
        "id": 37,
        "label": "Cruiser"
    },
    {
        "id": 38,
        "label": "Vehicle"
    },
    {
        "id": 39,
        "label": "Wing"
    },
    {
        "id": 40,
        "label": "PassengerWagon"
    },
    {
        "id": 41,
        "label": "People"
    },
    {
        "id": 42,
        "label": "VehicleComponent"
    },
    {
        "id": 43,
        "label": "WideBody"
    },
    {
        "id": 44,
        "label": "Truck"
    },
    {
        "id": 45,
        "label": "Rotor"
    },
    {
        "id": 46,
        "label": "Body"
    },
    {
        "id": 47,
        "label": "Boat"
    },
    {
        "id": 48,
        "label": "WingAircraft"
    }
]

  ,
  edges: [
    {
        "source": 2,
        "target": 36,
        "label": " has SubClass"
    },
    {
        "source": 2,
        "target": 43,
        "label": " has SubClass"
    },
    {
        "source": 3,
        "target": 21,
        "label": " has SubClass"
    },
    {
        "source": 3,
        "target": 7,
        "label": " has SubClass"
    },
    {
        "source": 3,
        "target": 4,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 44,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 13,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 1,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 29,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 23,
        "label": " has SubClass"
    },
    {
        "source": 10,
        "target": 17,
        "label": " has SubClass"
    },
    {
        "source": 10,
        "target": 40,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 26,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 31,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 28,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 12,
        "label": " has SubClass"
    },
    {
        "source": 25,
        "target": 27,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 48,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 34,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 9,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 22,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 2,
        "label": " has SubClass"
    },
    {
        "source": 2,
        "target": 36,
        "label": " has SubClass"
    },
    {
        "source": 2,
        "target": 43,
        "label": " has SubClass"
    },
    {
        "source": 33,
        "target": 47,
        "label": " has SubClass"
    },
    {
        "source": 33,
        "target": 6,
        "label": " has SubClass"
    },
    {
        "source": 33,
        "target": 37,
        "label": " has SubClass"
    },
    {
        "source": 38,
        "target": 33,
        "label": " has SubClass"
    },
    {
        "source": 33,
        "target": 47,
        "label": " has SubClass"
    },
    {
        "source": 33,
        "target": 6,
        "label": " has SubClass"
    },
    {
        "source": 33,
        "target": 37,
        "label": " has SubClass"
    },
    {
        "source": 38,
        "target": 30,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 48,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 34,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 9,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 22,
        "label": " has SubClass"
    },
    {
        "source": 30,
        "target": 2,
        "label": " has SubClass"
    },
    {
        "source": 2,
        "target": 36,
        "label": " has SubClass"
    },
    {
        "source": 2,
        "target": 43,
        "label": " has SubClass"
    },
    {
        "source": 38,
        "target": 5,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 44,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 13,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 1,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 29,
        "label": " has SubClass"
    },
    {
        "source": 5,
        "target": 23,
        "label": " has SubClass"
    },
    {
        "source": 38,
        "target": 3,
        "label": " has SubClass"
    },
    {
        "source": 3,
        "target": 21,
        "label": " has SubClass"
    },
    {
        "source": 3,
        "target": 7,
        "label": " has SubClass"
    },
    {
        "source": 3,
        "target": 4,
        "label": " has SubClass"
    },
    {
        "source": 39,
        "target": 32,
        "label": " has SubClass"
    },
    {
        "source": 41,
        "target": 24,
        "label": " has SubClass"
    },
    {
        "source": 41,
        "target": 20,
        "label": " has SubClass"
    },
    {
        "source": 41,
        "target": 35,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 39,
        "label": " has SubClass"
    },
    {
        "source": 39,
        "target": 32,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 10,
        "label": " has SubClass"
    },
    {
        "source": 10,
        "target": 17,
        "label": " has SubClass"
    },
    {
        "source": 10,
        "target": 40,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 19,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 15,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 14,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 18,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 26,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 31,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 28,
        "label": " has SubClass"
    },
    {
        "source": 18,
        "target": 12,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 0,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 45,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 46,
        "label": " has SubClass"
    },
    {
        "source": 42,
        "target": 11,
        "label": " has SubClass"
    }
]

}
var w = $(document).width();
var h = $(document).height();
var linkDistance=200;

var colors = d3.scale.category10();
var svg = d3.select("#tree-container").append("svg").attr({"width":w,"height":h});

    var force = d3.layout.force()
        .nodes(dataset.nodes)
        .links(dataset.edges)
        .size([w,h])
        .linkDistance([linkDistance])
        .charge([-500])
        .theta(0.1)
        .gravity(0.05)
        .start();

 

    var edges = svg.selectAll("line")
      .data(dataset.edges)
      .enter()
      .append("line")
      .attr("id",function(d,i) {return 'edge'+i})
      .attr('marker-end','url(#arrowhead)')
      .style("stroke","#ccc")
      .style("pointer-events", "none");
    
    var nodes = svg.selectAll("circle")
      .data(dataset.nodes)
      .enter()
      .append("circle")
      .attr({"r":15})
      .style("fill",function(d,i){return colors(i);})
      .call(force.drag)


    var nodelabels = svg.selectAll(".nodelabel") 
       .data(dataset.nodes)
       .enter()
       .append("text")
       .attr({"x":function(d){return d.x;},
              "y":function(d){return d.y;},
              "class":"nodelabel",
              "stroke":"black"})
       .text(function(d){return d.label;});

    var edgepaths = svg.selectAll(".edgepath")
        .data(dataset.edges)
        .enter()
        .append('path')
        .attr({'d': function(d) {return 'M '+d.source.x+' '+d.source.y+' L '+ d.target.x +' '+d.target.y},
               'class':'edgepath',
               'fill-opacity':0,
               'stroke-opacity':0,
               'fill':'blue',
               'stroke':'red',
               'id':function(d,i) {return 'edgepath'+i}})
        .style("pointer-events", "none");

    var edgelabels = svg.selectAll(".edgelabel")
        .data(dataset.edges)
        .enter()
        .append('text')
        .style("pointer-events", "none")
        .attr({'class':'edgelabel',
               'id':function(d,i){return d.label+i},
               'dx':80,
               'dy':0,
               'font-size':10,
               'fill':'#aaa'});

    edgelabels.append('textPath')
        .attr('xlink:href',function(d,i) {return '#edgepath'+i})
        .style("pointer-events", "none")
        .text(function(d,i){return d.label +i});


    svg.append('defs').append('marker')
        .attr({'id':'arrowhead',
               'viewBox':'-0 -5 10 10',
               'refX':25,
               'refY':0,
               //'markerUnits':'strokeWidth',
               'orient':'auto',
               'markerWidth':10,
               'markerHeight':10,
               'xoverflow':'visible'})
        .append('svg:path')
            .attr('d', 'M 0,-5 L 10 ,0 L 0,5')
            .attr('fill', '#ccc')
            .attr('stroke','#ccc');
     

    force.on("tick", function(){

        edges.attr({"x1": function(d){return d.source.x;},
                    "y1": function(d){return d.source.y;},
                    "x2": function(d){return d.target.x;},
                    "y2": function(d){return d.target.y;}
        });

        nodes.attr({"cx":function(d){return d.x;},
                    "cy":function(d){return d.y;}
        });

        nodelabels.attr("x", function(d) { return d.x; }) 
                  .attr("y", function(d) { return d.y; });

        edgepaths.attr('d', function(d) { var path='M '+d.source.x+' '+d.source.y+' L '+ d.target.x +' '+d.target.y;
                                           //console.log(d)
                                           return path});       

        edgelabels.attr('transform',function(d,i){
            if (d.target.x<d.source.x){
                bbox = this.getBBox();
                rx = bbox.x+bbox.width/2;
                ry = bbox.y+bbox.height/2;
                return 'rotate(180 '+rx+' '+ry+')';
                }
            else {
                return 'rotate(0)';
                }
        });
    });